{"version":3,"sources":["app.babeled.min.js","app.babeled.js"],"names":["clearSearch","$input","$","val","resultDiv","removeClass","links","find","hide","show","stackedMeta","title","xname","this","stackedcolumn2d","caption","xAxisname","yAxisName","showSum","theme","stackedcolumn3d","dataSrc","column2d","pie2d","showBorder","use3DLighting","enableSmartLabels","startingAngle","showLabels","showPercentValues","showLegend","centerLabelBold","showTooltip","decimals","useDataPlotColorForLabels","column3d","pie3d","line2d","lineThickness","paletteColors","baseFontColor","baseFont","captionFontSize","subcaptionFontSize","subcaptionFontBold","bgColor","showShadow","canvasBgColor","canvasBorderAlpha","divlineAlpha","divlineColor","divlineThickness","divLineIsDashed","divLineDashLen","divLineGapLen","showXAxisLine","xAxisLineThickness","xAxisLineColor","showAlternateHGridColor","showProjects","popup","link","html","url","data","get","htmlStr","append","accordion","click","startEdit","showProj","id","modal","deleteProject","res","ok","text","dropdown","xhr","XMLHttpRequest","open","onload","JSON","parse","responseText","formData","FormData","send","document","ready","restoreChart","chartController","changeSize","enlargeChart","addClass","checkbox","tab","btn","adv","hasClass","onChecked","onUnchecked","tableFields","projects","authorizing","changeContainer","contnr","container","showChart","w","h","width","height","renderChart","field","tb","dataSrc0","chartData","table","mainField","secondField","chartType","qstr","data0","type","events","chartClick","evt","dat","console","log","dataLabelClick","lastIndexOf","data1","chart","dataSrc1","FusionCharts","newChart","renderAt","dataFormat","dataSource","render","switchType","i","length","tempField","switchSrc","field2","change","body","attr"],"mappings":"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","file":"app.babeled.min.js","sourcesContent":["'use strict';\n\n$(document).ready(function () {\n\n    //layer btn selected\n    $(\".toggle.checkbox.base-toggle\").checkbox().checkbox('check');\n    $('.ui.dropdown').dropdown();\n    $('.ui.accordion').accordion();\n    $('.tabular.menu .item').tab();\n    $('.advanced-search.button').click(function () {\n        var btn = $('this');\n        var adv = $('#map-container .advanced');\n        if (adv.hasClass('shown')) {\n            adv.removeClass('shown');\n            btn.text('高级');\n        } else {\n            adv.addClass('shown');\n            $('a.item[data-tab=\"first\"]').click();\n            btn.text('收起');\n        }\n    });\n    $('.toggle-chart.checkbox').checkbox().checkbox({\n        onChecked: function onChecked() {\n            $('#bottom-left-view').show();\n        },\n        onUnchecked: function onUnchecked() {\n            $('#bottom-left-view').hide();\n        }\n    });\n\n    var tableFields = {\n        projects: ['项目进展情况', '填海情况', '填海超面积情况', '海域使用上报情况', '动态监测情况', '违法情况', '用海调整情况', '调整上报情况', '调整上报审批情况', '确权发证情况', '受益方上报情况', '受益方上报审批情况'],\n        authorizing: ['配号来源', '用海一级类', '用海二级类', '用海方式']\n    };\n\n    var chartController = function () {\n        var inviewData = 0; //inviewData=0 means data is single series, for normal chart, =1 means stacked chart\n        var data0 = []; //data0 is normal chart data\n        var data1 = {}; //data1 is stacked chart data\n        var table = ''; //database table in use\n        var mainField = '';\n        var secondField = '';\n        var dataSrc0 = {};\n        var dataSrc1 = {};\n        var chartData = {};\n        var chartType = '';\n        var container = 'myChart';\n        var width = 500;\n        var height = 300;\n\n        function changeContainer(contnr) {\n            container = contnr;\n            showChart();\n        }\n\n        function changeSize(w, h) {\n            width = w;\n            height = h;\n            showChart();\n        }\n\n        function renderChart(field, tb) {\n            dataSrc0 = {};\n            chartData = {};\n            table = tb;\n            mainField = field;\n            secondField = '';\n            chartType = 'column2d';\n            var qstr = 'SELECT `' + field + '` as label, count(`' + field + '` = `' + field + '`) as value FROM gis1.' + tb + ' group by `' + field + '`';\n            $.get('/mysql/exq?qs=' + qstr, function (res) {\n                data0 = res;\n                dataSrc0 = new dataSrc(field + '数量统计');\n                showChart();\n            });\n        }\n\n        function showChart(type) {\n            chartType = type ? type : chartType;\n            chartData = {\n                events: {\n                    \"chartClick\": function chartClick(evt, dat) {\n                        console.log(evt);\n                        console.log(dat);\n                    },\n                    \"dataLabelClick\": function dataLabelClick(evt, dat) {\n                        console.log(evt);\n                        console.log(dat);\n                    }\n                }\n            };\n            if (chartType.lastIndexOf('stacked') === 0) {\n                chartData = data1;\n                chartData.chart = dataSrc1[chartType];\n            } else {\n                chartData.data = data0;\n                chartData.chart = dataSrc0[chartType];\n            };\n\n            FusionCharts.ready(function () {\n                var newChart = new FusionCharts({\n                    \"type\": chartType,\n                    \"renderAt\": container,\n                    \"width\": width,\n                    \"height\": height,\n                    \"dataFormat\": \"json\",\n                    \"dataSource\": chartData\n                });\n                newChart.render();\n            });\n        }\n\n        function switchType(type) {\n            if (type !== chartType) {\n                chartType = type;\n                if (chartType.lastIndexOf('stacked') === 0) {\n                    if (secondField == '') {\n                        for (var i in tableFields[table]) {\n                            if (tableFields[table][i] == mainField) {\n                                secondField = tableFields[table][(i + 1) % tableFields[table].length];\n                                $('select[name=series]').dropdown('set selected', secondField);\n                                break;\n                            }\n                        }\n                        $.get('/mysql/get_stacked_data?field1=' + mainField + '&field2=' + secondField + '&tb=' + table, function (res) {\n                            data1 = res;\n                            dataSrc1 = new stackedMeta(mainField + '按' + secondField + '分类统计', mainField);\n                            showChart();\n                        });\n                    }\n                    var tempField = $('select[name=series]').val();\n                    if (secondField === tempField) {\n                        showChart();\n                    } else {\n                        $.get('/mysql/get_stacked_data?field1=' + mainField + '&field2=' + secondField + '&tb=' + table, function (res) {\n                            data1 = res;\n                            dataSrc1 = new stackedMeta(mainField + '按' + secondField + '分类统计', mainField);\n                            showChart();\n                            secondField = tempField;\n                        });\n                    }\n                } else {\n                    showChart();\n                }\n            }\n        }\n\n        function switchSrc(field2) {\n            if (secondField !== field2 && mainField !== field2) {\n                secondField = field2;\n                $.get('/mysql/get_stacked_data?field1=' + mainField + '&field2=' + secondField + '&tb=' + table, function (res) {\n                    data1 = res;\n                    dataSrc1 = new stackedMeta(mainField + '按' + secondField + '分类统计', mainField);\n                    showChart();\n                });\n            }\n        }\n\n        return {\n            renderChart: renderChart,\n            switchType: switchType,\n            switchSrc: switchSrc,\n            changeContainer: changeContainer,\n            changeSize: changeSize\n        };\n    }();\n    $('.toggle-chart.checkbox').checkbox().checkbox('uncheck');\n    //click show charts\n    $('.toggle-chart.checkbox').checkbox().checkbox({\n        onChecked: function onChecked() {\n            $('#bottom-left-view').show();\n            $('#myChart.chart').html('<div class=\"ui segment\"><div class=\"ui active inverted dimmer\"><div class=\"ui loader\"></div></div><p></p></div>');\n\n            var field = $(this).data('type');\n            $('.chart-selection.series.auth').hide();\n            $('.chart-selection.series.proj').show();\n            $('.series-container').hide();\n            $('select[name=chartType]').dropdown('set selected', 'column2d');\n            chartController.renderChart(field, 'projects');\n        },\n        onUnchecked: function onUnchecked() {\n            $('#bottom-left-view').hide();\n        }\n    });\n\n    $('.item.statistic.auth').click(function () {\n        $('#bottom-left-view').show();\n        $('#myChart.chart').html('<div class=\"ui segment\"><div class=\"ui active inverted dimmer\"><div class=\"ui loader\"></div></div><p></p></div>');\n        var field = $(this).data('type');\n        $('.chart-selection.series.proj').hide();\n        $('.chart-selection.series.auth').show();\n        $('.series-container').hide();\n        $('select[name=chartType]').dropdown('set selected', 'column2d');\n        chartController.renderChart(field, 'authorizing');\n    });\n\n    $('select[name=chartType]').change(function () {\n        var type = $(this).val();\n        if (type.lastIndexOf('stacked') === 0) {\n            $('.series-container').show();\n        } else {\n            $('.series-container').hide();\n        }\n        chartController.switchType(type);\n    });\n\n    $('select[name=series]').change(function () {\n        chartController.switchSrc($(this).val());\n    });\n\n    //click expand full screen\n    $('a#fullScreen').click(function () {\n        var btn = $(this);\n        var body = $('body');\n        if (body.hasClass('full-screen')) {\n            body.removeClass('full-screen');\n            btn.find('.fa-compress').hide();\n            btn.find('.fa-expand').show();\n            btn.attr('title', 'exit full screen');\n        } else {\n            body.addClass('full-screen');\n            btn.find('.fa-expand').hide();\n            btn.find('.fa-compress').show();\n            btn.attr('title', 'expand full screen');\n        }\n    });\n    $('#bottom-left-view #buttons i.fa.fa-expand.expand').click(enlargeChart);\n    $('#bottom-left-view #buttons i.fa.fa-compress.compress').click(restoreChart);\n\n    function restoreChart() {\n        $('#bottom-left-view').removeClass('large');\n        chartController.changeSize(500, 300);\n        $(this).hide();\n        $('#bottom-left-view #buttons i.fa.fa-expand.expand').show();\n    }\n\n    function enlargeChart() {\n        $('#bottom-left-view').addClass('large');\n        chartController.changeSize(840, 500);\n        $(this).hide();\n        $('#bottom-left-view #buttons i.fa.fa-compress.compress').show();\n    }\n});\n\nfunction clearSearch() {\n    var $input = $('input[name=\"search\"');\n    $input.val('');\n    var resultDiv = $('#searchResult.results');\n    resultDiv.removeClass('visible');\n    var links = resultDiv.find(\".download-results\");\n    links.hide();\n    $('i.icon.search').show();\n    $('i.icon.remove').hide();\n    $('.category.results').hide();\n}\n\nfunction stackedMeta(title, xname) {\n    this.stackedcolumn2d = {\n        \"caption\": title,\n        \"xAxisname\": xname,\n        \"yAxisName\": \"数量\",\n        \"showSum\": \"1\",\n        \"theme\": \"fint\"\n    };\n    this.stackedcolumn3d = this.stackedcolumn2d;\n}\n\nfunction dataSrc(title) {\n    this.column2d = {\n        \"caption\": title,\n        \"yAxisName\": \"数量\",\n        \"theme\": \"fint\"\n    };\n    this.pie2d = {\n        \"caption\": title,\n        \"showBorder\": \"0\",\n        \"use3DLighting\": \"0\",\n        \"enableSmartLabels\": \"0\",\n        \"startingAngle\": \"310\",\n        \"showLabels\": \"0\",\n        \"showPercentValues\": \"1\",\n        \"showLegend\": \"1\",\n        \"centerLabelBold\": \"1\",\n        \"showTooltip\": \"0\",\n        \"decimals\": \"0\",\n        \"useDataPlotColorForLabels\": \"1\",\n        \"theme\": \"fint\"\n    };\n    this.column3d = this.column2d;\n    this.pie3d = this.pie2d;\n    this.line2d = {\n        \"caption\": title,\n        \"yAxisName\": \"数量\",\n        \"lineThickness\": \"2\",\n        \"paletteColors\": \"#0075c2\",\n        \"baseFontColor\": \"#333333\",\n        \"baseFont\": \"Helvetica Neue,Arial\",\n        \"captionFontSize\": \"14\",\n        \"subcaptionFontSize\": \"14\",\n        \"subcaptionFontBold\": \"0\",\n        \"showBorder\": \"0\",\n        \"bgColor\": \"#ffffff\",\n        \"showShadow\": \"0\",\n        \"canvasBgColor\": \"#ffffff\",\n        \"canvasBorderAlpha\": \"0\",\n        \"divlineAlpha\": \"100\",\n        \"divlineColor\": \"#999999\",\n        \"divlineThickness\": \"1\",\n        \"divLineIsDashed\": \"1\",\n        \"divLineDashLen\": \"1\",\n        \"divLineGapLen\": \"1\",\n        \"showXAxisLine\": \"1\",\n        \"xAxisLineThickness\": \"1\",\n        \"xAxisLineColor\": \"#999999\",\n        \"showAlternateHGridColor\": \"0\"\n    };\n}\n\nfunction showProjects() {\n    var popup = $('.esri-popup-renderer-text.esri-popup-renderer-content-element');\n    var link = popup.find('.projects-link');\n    popup.html('<div class=\"ui segment\"><div class=\"ui active inverted dimmer\"><div class=\"ui loader\"></div></div><p></p></div>');\n\n    var url = '/mysql/get_projects?zone=' + link.data('zone');\n    if (link.data('field')) {\n        url += '&field=' + link.data('field') + '&val=' + link.data('val');\n    };\n    $.get(url, function (htmlStr) {\n        if (htmlStr == '') {\n            popup.html('该区域没有项目信息');\n            return;\n        }\n        popup.html(htmlStr);\n        if (link.data('field')) {\n            $('h1.esri-title').append(': ' + link.data('val') + '项目');\n        };\n        $('.projects .ui.styled.fluid.accordion').accordion();\n        $('.projects .content .edit-project').click(startEdit);\n        $('.content a.enlarge').click(function () {\n            showProj($(this).data('id'));\n        });\n    });\n}\n\nfunction showProj(id) {\n    $.get('/mysql/project?id=' + id, function (html) {\n        $('#modal').html('<i class=\"close fa fa-remove\" />');\n        $('#modal').append(html);\n        $('#modal').modal('show');\n        $('.modal .content .edit-project').click(startEdit);\n    });\n}\n\nfunction deleteProject() {\n    $('#modal .content').html('<div class=\"ui segment\"><div class=\"ui active inverted dimmer\"><div class=\"ui loader\"></div></div><p></p></div>');\n    $.get($(this.data('href')), function (res) {\n        if (res.ok) {\n            $('#modal .loader').text('信息已删除');\n        } else {\n            $('#modal .loader').text('删除时发生错误');\n        }\n    });\n}\n\nfunction startEdit() {\n    var url = '/mysql/edit_project?id=' + $(this).data('id');\n    $('#modal .content').html('<div class=\"ui segment\"><div class=\"ui active inverted dimmer\"><div class=\"ui loader\"></div></div><p></p></div>');\n\n    $.get(url, function (res) {\n\n        $('#modal .content').html(res);\n        $('.ui.dropdown').dropdown();\n        $('#modal').modal('show');\n        $('.save-project').click(function () {\n            var id = $(this.data('id'));\n            var xhr = new XMLHttpRequest();\n            xhr.open('POST', '/mysql/edit_project？id=' + id);\n\n            xhr.onload = function () {\n                var res = JSON.parse(xhr.responseText);\n                if (res.ok) {\n                    $.get('/mysql/project?id=' + res.id, function (html) {\n                        $('#modal .content').html($(html).find('.content'));\n                        $('.modal .content .edit-project').click(startEdit);\n                    });\n                }\n            };\n            var formData = new FormData($('form.project')[0]);\n            xhr.send(formData);\n        });\n    });\n}","$(document).ready(() => {\r\n\r\n    //layer btn selected\r\n    $(\".toggle.checkbox.base-toggle\").checkbox().checkbox('check');\r\n    $('.ui.dropdown').dropdown();\r\n    $('.ui.accordion').accordion();\r\n    $('.tabular.menu .item').tab();\r\n    $('.advanced-search.button').click(function() {\r\n        var btn = $('this');\r\n        var adv = $('#map-container .advanced');\r\n        if (adv.hasClass('shown')) {\r\n            adv.removeClass('shown');\r\n            btn.text('高级');\r\n        } else {\r\n            adv.addClass('shown');\r\n            $('a.item[data-tab=\"first\"]').click();\r\n            btn.text('收起');\r\n        }\r\n    });\r\n    $('.toggle-chart.checkbox').checkbox().checkbox({\r\n        onChecked: function() {\r\n            $('#bottom-left-view').show();\r\n        },\r\n        onUnchecked: function() {\r\n            $('#bottom-left-view').hide();\r\n        }\r\n    });\r\n\r\n    var tableFields = {\r\n        projects: ['项目进展情况',\r\n            '填海情况',\r\n            '填海超面积情况',\r\n            '海域使用上报情况',\r\n            '动态监测情况',\r\n            '违法情况',\r\n            '用海调整情况',\r\n            '调整上报情况',\r\n            '调整上报审批情况',\r\n            '确权发证情况',\r\n            '受益方上报情况',\r\n            '受益方上报审批情况'\r\n        ],\r\n        authorizing: ['配号来源', '用海一级类', '用海二级类', '用海方式']\r\n    };\r\n\r\n    var chartController = function() {\r\n        var inviewData = 0; //inviewData=0 means data is single series, for normal chart, =1 means stacked chart\r\n        var data0 = []; //data0 is normal chart data\r\n        var data1 = {}; //data1 is stacked chart data\r\n        var table = ''; //database table in use\r\n        var mainField = '';\r\n        var secondField = '';\r\n        var dataSrc0 = {};\r\n        var dataSrc1 = {};\r\n        var chartData = {};\r\n        var chartType = '';\r\n        var container = 'myChart';\r\n        var width = 500;\r\n        var height = 300;\r\n\r\n        function changeContainer(contnr) {\r\n            container = contnr;\r\n            showChart();\r\n        }\r\n\r\n        function changeSize(w, h) {\r\n            width = w;\r\n            height = h;\r\n            showChart();\r\n        }\r\n\r\n        function renderChart(field, tb) {\r\n            dataSrc0 = {};\r\n            chartData = {};\r\n            table = tb;\r\n            mainField = field;\r\n            secondField = '';\r\n            chartType = 'column2d';\r\n            var qstr = 'SELECT `' + field + '` as label, count(`' + field + '` = `' + field + '`) as value FROM gis1.' + tb + ' group by `' + field + '`';\r\n            $.get('/mysql/exq?qs=' + qstr, function(res) {\r\n                data0 = res;\r\n                dataSrc0 = new dataSrc(field + '数量统计');\r\n                showChart();\r\n            })\r\n        }\r\n\r\n        function showChart(type) {\r\n            chartType = type ? type : chartType;\r\n            chartData = {\r\n                events: {\r\n                    \"chartClick\": function(evt, dat) {\r\n                        console.log(evt);\r\n                        console.log(dat);\r\n                    },\r\n                    \"dataLabelClick\": function(evt, dat) {\r\n                        console.log(evt);\r\n                        console.log(dat);\r\n                    },\r\n                }\r\n            };\r\n            if (chartType.lastIndexOf('stacked') === 0) {\r\n                chartData = data1;\r\n                chartData.chart = dataSrc1[chartType];\r\n            } else {\r\n                chartData.data = data0;\r\n                chartData.chart = dataSrc0[chartType];\r\n\r\n            };\r\n\r\n            FusionCharts.ready(function() {\r\n                var newChart = new FusionCharts({\r\n                    \"type\": chartType,\r\n                    \"renderAt\": container,\r\n                    \"width\": width,\r\n                    \"height\": height,\r\n                    \"dataFormat\": \"json\",\r\n                    \"dataSource\": chartData\r\n                });\r\n                newChart.render();\r\n            })\r\n        }\r\n\r\n        function switchType(type) {\r\n            if (type !== chartType) {\r\n                chartType = type;\r\n                if (chartType.lastIndexOf('stacked') === 0) {\r\n                    if (secondField == '') {\r\n                        for (let i in tableFields[table]) {\r\n                            if (tableFields[table][i] == mainField) {\r\n                                secondField = tableFields[table][(i + 1) % (tableFields[table].length)];\r\n                                $('select[name=series]').dropdown('set selected', secondField);\r\n                                break;\r\n                            }\r\n                        }\r\n                        $.get('/mysql/get_stacked_data?field1=' + mainField + '&field2=' + secondField + '&tb=' + table, function(res) {\r\n                            data1 = res;\r\n                            dataSrc1 = new stackedMeta(mainField + '按' + secondField + '分类统计', mainField);\r\n                            showChart();\r\n                        });\r\n                    }\r\n                    var tempField = $('select[name=series]').val();\r\n                    if (secondField === tempField) {\r\n                        showChart();\r\n                    } else {\r\n                        $.get('/mysql/get_stacked_data?field1=' + mainField + '&field2=' + secondField + '&tb=' + table, function(res) {\r\n                            data1 = res;\r\n                            dataSrc1 = new stackedMeta(mainField + '按' + secondField + '分类统计', mainField);\r\n                            showChart();\r\n                            secondField = tempField;\r\n                        })\r\n                    }\r\n                } else {\r\n                    showChart();\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        function switchSrc(field2) {\r\n            if (secondField !== field2 && mainField !== field2) {\r\n                secondField = field2;\r\n                $.get('/mysql/get_stacked_data?field1=' + mainField + '&field2=' + secondField + '&tb=' + table, function(res) {\r\n                    data1 = res;\r\n                    dataSrc1 = new stackedMeta(mainField + '按' + secondField + '分类统计', mainField);\r\n                    showChart();\r\n                })\r\n            }\r\n        }\r\n\r\n        return {\r\n            renderChart: renderChart,\r\n            switchType: switchType,\r\n            switchSrc: switchSrc,\r\n            changeContainer: changeContainer,\r\n            changeSize: changeSize\r\n        }\r\n    }();\r\n    $('.toggle-chart.checkbox').checkbox().checkbox('uncheck');\r\n    //click show charts\r\n    $('.toggle-chart.checkbox').checkbox().checkbox({\r\n        onChecked: function() {\r\n            $('#bottom-left-view').show();\r\n            $('#myChart.chart').html('<div class=\"ui segment\"><div class=\"ui active inverted dimmer\"><div class=\"ui loader\"></div></div><p></p></div>');\r\n\r\n            var field = $(this).data('type');\r\n            $('.chart-selection.series.auth').hide();\r\n            $('.chart-selection.series.proj').show();\r\n            $('.series-container').hide();\r\n            $('select[name=chartType]').dropdown('set selected', 'column2d');\r\n            chartController.renderChart(field, 'projects');\r\n        },\r\n        onUnchecked: function() {\r\n            $('#bottom-left-view').hide();\r\n        }\r\n    });\r\n\r\n    $('.item.statistic.auth').click(function() {\r\n        $('#bottom-left-view').show();\r\n        $('#myChart.chart').html('<div class=\"ui segment\"><div class=\"ui active inverted dimmer\"><div class=\"ui loader\"></div></div><p></p></div>');\r\n        var field = $(this).data('type');\r\n        $('.chart-selection.series.proj').hide();\r\n        $('.chart-selection.series.auth').show();\r\n        $('.series-container').hide();\r\n        $('select[name=chartType]').dropdown('set selected', 'column2d');\r\n        chartController.renderChart(field, 'authorizing');\r\n    });\r\n\r\n    $('select[name=chartType]').change(function() {\r\n        var type = $(this).val()\r\n        if (type.lastIndexOf('stacked') === 0) {\r\n            $('.series-container').show();\r\n        } else {\r\n            $('.series-container').hide();\r\n        }\r\n        chartController.switchType(type);\r\n    });\r\n\r\n\r\n    $('select[name=series]').change(function() {\r\n        chartController.switchSrc($(this).val());\r\n    });\r\n\r\n    //click expand full screen\r\n    $('a#fullScreen').click(function() {\r\n        var btn = $(this);\r\n        var body = $('body');\r\n        if (body.hasClass('full-screen')) {\r\n            body.removeClass('full-screen');\r\n            btn.find('.fa-compress').hide();\r\n            btn.find('.fa-expand').show();\r\n            btn.attr('title', 'exit full screen');\r\n        } else {\r\n            body.addClass('full-screen');\r\n            btn.find('.fa-expand').hide();\r\n            btn.find('.fa-compress').show();\r\n            btn.attr('title', 'expand full screen');\r\n        }\r\n    })\r\n    $('#bottom-left-view #buttons i.fa.fa-expand.expand').click(enlargeChart);\r\n    $('#bottom-left-view #buttons i.fa.fa-compress.compress').click(restoreChart);\r\n\r\n    function restoreChart() {\r\n        $('#bottom-left-view').removeClass('large');\r\n        chartController.changeSize(500, 300);\r\n        $(this).hide();\r\n        $('#bottom-left-view #buttons i.fa.fa-expand.expand').show()\r\n    }\r\n\r\n    function enlargeChart() {\r\n        $('#bottom-left-view').addClass('large');\r\n        chartController.changeSize(840, 500);\r\n        $(this).hide();\r\n        $('#bottom-left-view #buttons i.fa.fa-compress.compress').show()\r\n    }\r\n})\r\n\r\n\r\nfunction clearSearch() {\r\n    var $input = $('input[name=\"search\"');\r\n    $input.val('');\r\n    var resultDiv = $('#searchResult.results');\r\n    resultDiv.removeClass('visible');\r\n    var links = resultDiv.find(\".download-results\");\r\n    links.hide();\r\n    $('i.icon.search').show();\r\n    $('i.icon.remove').hide();\r\n    $('.category.results').hide();\r\n}\r\n\r\nfunction stackedMeta(title, xname) {\r\n    this.stackedcolumn2d = {\r\n        \"caption\": title,\r\n        \"xAxisname\": xname,\r\n        \"yAxisName\": \"数量\",\r\n        \"showSum\": \"1\",\r\n        \"theme\": \"fint\"\r\n    };\r\n    this.stackedcolumn3d = this.stackedcolumn2d;\r\n}\r\n\r\nfunction dataSrc(title) {\r\n    this.column2d = {\r\n        \"caption\": title,\r\n        \"yAxisName\": \"数量\",\r\n        \"theme\": \"fint\"\r\n    };\r\n    this.pie2d = {\r\n        \"caption\": title,\r\n        \"showBorder\": \"0\",\r\n        \"use3DLighting\": \"0\",\r\n        \"enableSmartLabels\": \"0\",\r\n        \"startingAngle\": \"310\",\r\n        \"showLabels\": \"0\",\r\n        \"showPercentValues\": \"1\",\r\n        \"showLegend\": \"1\",\r\n        \"centerLabelBold\": \"1\",\r\n        \"showTooltip\": \"0\",\r\n        \"decimals\": \"0\",\r\n        \"useDataPlotColorForLabels\": \"1\",\r\n        \"theme\": \"fint\"\r\n    };\r\n    this.column3d = this.column2d;\r\n    this.pie3d = this.pie2d;\r\n    this.line2d = {\r\n        \"caption\": title,\r\n        \"yAxisName\": \"数量\",\r\n        \"lineThickness\": \"2\",\r\n        \"paletteColors\": \"#0075c2\",\r\n        \"baseFontColor\": \"#333333\",\r\n        \"baseFont\": \"Helvetica Neue,Arial\",\r\n        \"captionFontSize\": \"14\",\r\n        \"subcaptionFontSize\": \"14\",\r\n        \"subcaptionFontBold\": \"0\",\r\n        \"showBorder\": \"0\",\r\n        \"bgColor\": \"#ffffff\",\r\n        \"showShadow\": \"0\",\r\n        \"canvasBgColor\": \"#ffffff\",\r\n        \"canvasBorderAlpha\": \"0\",\r\n        \"divlineAlpha\": \"100\",\r\n        \"divlineColor\": \"#999999\",\r\n        \"divlineThickness\": \"1\",\r\n        \"divLineIsDashed\": \"1\",\r\n        \"divLineDashLen\": \"1\",\r\n        \"divLineGapLen\": \"1\",\r\n        \"showXAxisLine\": \"1\",\r\n        \"xAxisLineThickness\": \"1\",\r\n        \"xAxisLineColor\": \"#999999\",\r\n        \"showAlternateHGridColor\": \"0\"\r\n    };\r\n}\r\n\r\n\r\n\r\nfunction showProjects() {\r\n    var popup = $('.esri-popup-renderer-text.esri-popup-renderer-content-element');\r\n    var link = popup.find('.projects-link');\r\n    popup.html('<div class=\"ui segment\"><div class=\"ui active inverted dimmer\"><div class=\"ui loader\"></div></div><p></p></div>');\r\n\r\n    var url = '/mysql/get_projects?zone=' + link.data('zone');\r\n    if (link.data('field')) {\r\n        url += '&field=' + link.data('field') + '&val=' + link.data('val');\r\n    };\r\n    $.get(url, function(htmlStr) {\r\n        if (htmlStr == '') {\r\n            popup.html('该区域没有项目信息');\r\n            return;\r\n        }\r\n        popup.html(htmlStr);\r\n        if (link.data('field')) {\r\n            $('h1.esri-title').append(': ' + link.data('val') + '项目');\r\n        };\r\n        $('.projects .ui.styled.fluid.accordion').accordion();\r\n        $('.projects .content .edit-project').click(startEdit);\r\n        $('.content a.enlarge').click(function() {\r\n            showProj($(this).data('id'));\r\n        });\r\n    })\r\n}\r\n\r\nfunction showProj(id) {\r\n    $.get('/mysql/project?id=' + id, function(html) {\r\n        $('#modal').html('<i class=\"close fa fa-remove\" />');\r\n        $('#modal').append(html);\r\n        $('#modal').modal('show');\r\n        $('.modal .content .edit-project').click(startEdit);\r\n    })\r\n}\r\n\r\nfunction deleteProject() {\r\n    $('#modal .content').html('<div class=\"ui segment\"><div class=\"ui active inverted dimmer\"><div class=\"ui loader\"></div></div><p></p></div>');\r\n    $.get($(this.data('href')), function(res) {\r\n        if (res.ok) {\r\n            $('#modal .loader').text('信息已删除');\r\n\r\n        } else {\r\n            $('#modal .loader').text('删除时发生错误');\r\n        }\r\n\r\n    })\r\n}\r\n\r\n\r\n\r\nfunction startEdit() {\r\n    var url = '/mysql/edit_project?id=' + $(this).data('id');\r\n    $('#modal .content').html('<div class=\"ui segment\"><div class=\"ui active inverted dimmer\"><div class=\"ui loader\"></div></div><p></p></div>');\r\n\r\n    $.get(url, function(res) {\r\n\r\n        $('#modal .content').html(res);\r\n        $('.ui.dropdown').dropdown();\r\n        $('#modal').modal('show');\r\n        $('.save-project').click(function() {\r\n            var id = $(this.data('id'));\r\n            var xhr = new XMLHttpRequest();\r\n            xhr.open('POST', '/mysql/edit_project？id=' + id);\r\n\r\n            xhr.onload = function() {\r\n                var res = JSON.parse(xhr.responseText);\r\n                if (res.ok) {\r\n                    $.get('/mysql/project?id=' + res.id, function(html) {\r\n                        $('#modal .content').html($(html).find('.content'));\r\n                        $('.modal .content .edit-project').click(startEdit);\r\n                    })\r\n                }\r\n            };\r\n            var formData = new FormData($('form.project')[0]);\r\n            xhr.send(formData);\r\n        })\r\n\r\n    })\r\n\r\n}\r\n"],"sourceRoot":"/source/"}