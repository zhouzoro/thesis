{"version":3,"sources":["core.babeled.min.js","core.babeled.js"],"names":["require","Map","MapView","MapImageLayer","FeatureLayer","PopupTemplate","Legend","Compass","CompassVM","Home","HomeVM","BasemapToggle","Popup","QueryTask","Query","map","basemap","view","container","zoom","center","then","tableContent","compass","viewModel","startup","homeBtn","basemapToggle","nextBasemap","legend","ui","add","authLyrCtrl","lyrIds","authLyrs","id","url","popupTemplate","title","content","inviewIndex","i","tempLyr","push","whenLayerView","lyrView","watch","val","queryFeatures","results","console","log","on","switchTo","remove","show","this","hide","zoningLyrCtrl","zoningLyr","toggle","$","change"],"mappings":"AAAA,YCAAA,UACI,WACA,qBACA,4BACA,2BACA,qBACA,sBACA,uBACA,wCACA,oBACA,kCACA,6BACA,qBACA,uBACA,2BACA,kBACD,SAASC,EAAKC,EAASC,EAAeC,EAAcC,EAAeC,EAAQC,EAASC,EAAWC,EAAMC,EAAQC,EAAeC,EAAOC,EAAWC,GAE7I,GAAIC,GAAM,GAAId,IACVe,QAAS,WAGTC,EAAO,GAAIf,IACXgB,UAAW,gBACXH,IAAKA,EACLI,KAAM,EACNC,QAAS,IAAK,KAGlBH,GAAKI,KAAK,WAEN,GAEIC,GAAe,oPAGfC,EAAU,GAAIhB,IACdiB,UAAW,GAAIhB,IACXS,KAAMA,KAEX,UACHM,GAAQE,SAER,IAAIC,GAAU,GAAIjB,IACde,UAAW,GAAId,IACXO,KAAMA,KAEX,OACHS,GAAQD,SAER,IAAIE,GAAgB,GAAIhB,IACpBM,KAAMA,EACNW,YAAa,aACd,UACHD,GAAcF,SAzBG,IA6BbI,GAAS,GAAIvB,IACbW,KAAMA,GAEVY,GAAOJ,UAEPR,EAAKa,GAAGC,IAAIF,EAAQ,eAlCH,IAsCbG,GAAc,WAEd,GAAIC,IAAU,OAAQ,OAAQ,aAAc,cAAe,cAAe,cACtEC,IACJA,GAAS,GAAK,GAAI9B,IACd+B,GAAIF,EAAO,GACXG,IAAK,iEACLC,cAAe,GAAIhC,IACfiC,MAAO,QACPC,QAASjB,MAGjBP,EAAIgB,IAAIG,EAAS,GAEjB,KAAK,GADDM,GAAc,EACTC,EAAI,EAAO,EAAJA,EAAOA,IAAK,CACxB,GAAIC,GAAU,GAAItC,IACd+B,GAAIF,EAAOQ,GACXL,IAAK,gEAAkEK,EACvEJ,cAAe,GAAIhC,IACfiC,MAAO,QACPC,QAASjB,KAGjBY,GAASS,KAAKD,GAvBO,MA0BzBzB,GAAK2B,cAAcV,EAAS,IAAIb,KAAK,SAASwB,GAC1CA,EAAQC,MAAM,WAAY,SAASC,GAC1BA,GAGDF,EAAQG,gBAAgB3B,KAAK,SAAS4B,GAClCC,QAAQC,IAAIF,EAAQ,WA0ChCG,IAAI,EACJC,SAAU,SAAYN,GACdA,IAAQP,IACRzB,EAAIuC,OAAOpB,EAASM,IACpBzB,EAAIgB,IAAIG,EAASa,MAGzBQ,KAAM,WACFxC,EAAIgB,IAAIG,EAASM,IACjBgB,KAAKJ,IAAK,GAEdK,KAAM,WACF1C,EAAIuC,OAAOpB,EAASM,IACpBgB,KAAKJ,IAAK,OAMlBM,EAAgB,WAEhB,GAAIC,GAAY,GAAIvD,IAChB+B,GAAI,OACJC,IAAK,iEAGT,QACIgB,IAAI,EACJQ,OAAQ,WACAJ,KAAKJ,GACLrC,EAAIuC,OAAOK,IAGX5C,EAAIgB,IAAI4B,GACJ3B,EAAYoB,KACZpB,EAAYyB,KACZzB,EAAYuB,OAIpBC,KAAKJ,IAAMI,KAAKJ,OAK5BS,GAAE,8BAA8BC,OAAO,WACnCJ,EAAcE,SACdV,QAAQC,IAAIO,EAAcN,MAG9BS,EAAE,8BAA8BC,OAAO,WACd,MAAjBD,EAAEL,MAAMT,MACRf,EAAYuB,KAEZvB,EAAYyB,OAIpBI,EAAE,wBAAwBC,OAAO,WAC7B9B,EAAYqB,SAASQ,EAAEL,MAAMT","file":"core.babeled.min.js","sourcesContent":["\"use strict\";\n\nrequire([\"esri/Map\", \"esri/views/MapView\", \"esri/layers/MapImageLayer\", \"esri/layers/FeatureLayer\", \"esri/PopupTemplate\", \"esri/widgets/Legend\", \"esri/widgets/Compass\", \"esri/widgets/Compass/CompassViewModel\", \"esri/widgets/Home\", \"esri/widgets/Home/HomeViewModel\", \"esri/widgets/BasemapToggle\", \"esri/widgets/Popup\", \"esri/tasks/QueryTask\", \"esri/tasks/support/Query\", \"dojo/domReady!\"], function (Map, MapView, MapImageLayer, FeatureLayer, PopupTemplate, Legend, Compass, CompassVM, Home, HomeVM, BasemapToggle, Popup, QueryTask, Query) {\n\n    var map = new Map({\n        basemap: \"oceans\"\n    });\n\n    var view = new MapView({\n        container: \"map-container\",\n        map: map,\n        zoom: 9,\n        center: [121, 33]\n    });\n    var services = ['zoning', 'authorized', 'authorized_source', 'authorized_cata1', 'authorized_cata2', 'authorized_method'];\n    view.then(function () {\n\n        var content = \"<b>{FID}</b> {OBJECTID}<br>\" + \"功能区类型:{功能区类型}<br>\" + \"{SHAPE_LEN}\" + \"<img src='https://www.google.com/logos/doodles/2016/mohammed-ghani-hikmats-87th-birthday-5708620060688384-hp2x.jpg' />\";\n        var tableContent = '<table class=\"ui celled table\"><tbody><tr><td>' + 'FID' + '</td><td>' + '{FID}' + '</td></tr><tr><td>' + '配号来源' + '</td><td>' + '{配号来源}' + '</td></tr><tr><td>' + '用海一级类' + '</td><td>' + '{用海一级类}' + '</td></tr><tr><td>' + '用海二级类' + '</td><td>' + '{用海二级类}' + '</td></tr><tr><td>' + '用海方式' + '</td><td>' + '{用海方式}' + '</td></tr></tbody></table>';\n\n        //==widgets======================//\n        var compass = new Compass({\n            viewModel: new CompassVM({\n                view: view\n            })\n        }, \"compass\");\n        compass.startup();\n\n        var homeBtn = new Home({\n            viewModel: new HomeVM({\n                view: view\n            })\n        }, \"home\");\n        homeBtn.startup();\n\n        var basemapToggle = new BasemapToggle({\n            view: view,\n            nextBasemap: \"dark-gray\"\n        }, 'basemap');\n        basemapToggle.startup();\n\n        //var legend = new Legend({ view: view }, 'legend');\n\n        var legend = new Legend({\n            view: view\n        });\n        legend.startup();\n\n        view.ui.add(legend, \"bottom-right\");\n        //==widgets======================//\n\n        var authLyrCtrl = function () {\n\n            var lyrIds = ['功能区划', '确权数据', '确权数据--配号来源', '确权数据--用海一级类', '确权数据--用海二级类', '确权数据--用海方式'];\n            var authLyrs = [];\n            authLyrs[1] = new FeatureLayer({\n                id: lyrIds[1],\n                url: \"http://localhost:6080/arcgis/rest/services/allofit/MapServer/1\",\n                popupTemplate: new PopupTemplate({\n                    title: 'title',\n                    content: tableContent\n                })\n            });\n            map.add(authLyrs[1]);\n            var inviewIndex = 1;\n            for (var i = 2; i < 6; i++) {\n                var tempLyr = new FeatureLayer({\n                    id: lyrIds[i],\n                    url: \"http://localhost:6080/arcgis/rest/services/allofit/MapServer/\" + i,\n                    popupTemplate: new PopupTemplate({\n                        title: 'title',\n                        content: tableContent\n                    })\n                });\n                authLyrs.push(tempLyr);\n            }\n\n            view.whenLayerView(authLyrs[1]).then(function (lyrView) {\n                lyrView.watch(\"updating\", function (val) {\n                    if (!val) {\n                        // wait for the layer view to finish updating\n\n                        // query all the features available for drawing.\n                        lyrView.queryFeatures().then(function (results) {\n                            console.log(results[0]);\n\n                            /*graphics = results;\r\n                            var fragment = document.createDocumentFragment();\r\n                            results.forEach(function(result, index) {\r\n                            var attributes = result.attributes;\r\n                            var name = attributes.ZIP + \" (\" +\r\n                            attributes.PO_NAME + \")\"\r\n                            // Create a list zip codes in NY\r\n                            domConstruct.create(\"li\", {\r\n                            className: \"panel-result\",\r\n                            tabIndex: 0,\r\n                            \"data-result-id\": index,\r\n                            textContent: name\r\n                            }, fragment);\r\n                            });\r\n                            domConstruct.place(fragment, listNode, \"only\");*/\n                        });\n                    }\n                });\n            });\n            /*on(listNode, on.selector(\"li\", a11yclick), function(evt) {\r\n                var target = evt.target;\r\n                var resultId = domAttr.get(target, \"data-result-id\");\r\n                  // get the graphic corresponding to the clicked zip code\r\n                var result = resultId && graphics && graphics[parseInt(resultId,\r\n                    10)];\r\n                  if (result) {\r\n                    // open the popup at the centroid of zip code polygon\r\n                    // and set the popup's features which will populate popup content and title.\r\n                    view.popup.open({\r\n                        features: [result],\r\n                        location: result.geometry.centroid\r\n                    });\r\n                }\r\n            });*/\n\n            return {\n                on: true,\n                switchTo: function to(val) {\n                    if (val !== inviewIndex) {\n                        map.remove(authLyrs[inviewIndex]);\n                        map.add(authLyrs[val]);\n                    }\n                },\n                show: function show() {\n                    map.add(authLyrs[inviewIndex]);\n                    this.on = true;\n                },\n                hide: function hide() {\n                    map.remove(authLyrs[inviewIndex]);\n                    this.on = false;\n                }\n            };\n        }();\n\n        var zoningLyrCtrl = function () {\n\n            var zoningLyr = new FeatureLayer({\n                id: '功能区划',\n                url: \"http://localhost:6080/arcgis/rest/services/zoning/MapServer/0\"\n            });\n\n            return {\n                on: false,\n                toggle: function toggle() {\n                    if (this.on) {\n                        map.remove(zoningLyr);\n                    } else {\n\n                        map.add(zoningLyr);\n                        if (authLyrCtrl.on) {\n                            authLyrCtrl.hide;\n                            authLyrCtrl.show;\n                        }\n                    };\n                    this.on = !this.on;\n                }\n            };\n        }();\n\n        $('input.toggle.toggle-zoning').change(function () {\n            zoningLyrCtrl.toggle();\n            console.log(zoningLyrCtrl.on);\n        });\n\n        $('input.toggle.toggle-zoning').change(function () {\n            if ($(this).val() == 'on') {\n                authLyrCtrl.show;\n            } else {\n                authLyrCtrl.hide;\n            }\n        });\n        $('select[name=authLyr]').change(function () {\n            authLyrCtrl.switchTo($(this).val());\n        });\n\n        function dataSrc() {\n            this.chart = {\n                \"caption\": \"确权数据分类\",\n                \"subCaption\": \"用海一级类\",\n                \"xAxisName\": \"用海一级类\",\n                \"yAxisName\": \"数量\",\n                \"theme\": \"fint\"\n            };\n            this.data = [];\n        }\n        var col3dShow = [];\n\n        /*$.get('http://localhost:6080/arcgis/rest/services/allofit/MapServer/legend?f=pjson', function(res) {\r\n            legendJson = JSON.parse(res);\r\n            for (var i = 1; i < 6; i++) {\r\n                var layerTemp = legendJson.layers[i];\r\n                var layerLegend = layerTemp.legend;\r\n                var tempSrc = new dataSrc();\r\n                tempSrc.chart.subCaption = layerTemp.layerName;\r\n                tempSrc.chart.xAxisName = layerTemp.layerName;\r\n                var queryStatesTask = new QueryTask({\r\n                    url: \"http://localhost:6080/arcgis/rest/services/allofit/MapServer/\" + i\r\n                });\r\n                var promiseResults = [];\r\n                for (var j = layerLegend.length - 1; i >= 0; i--) {\r\n                    var legd = layerLegend[i];\r\n                    promiseResults.push(new Promise((resolve, reject) => {\r\n                        var query = new Query();\r\n                        query.where = layerTemp.layerName + \" = \" + \"'\" + legd.label + \"'\";\r\n                        queryStatesTask.execute(query).then(function(result) {\r\n                            console.log(result.features.length);\r\n                            var tempData = {\r\n                                \"label\": legd.label,\r\n                                \"value\": result.features.length\r\n                            };\r\n                            resolve(tempData);\r\n                        });\r\n                    }))\r\n                }\r\n                Promise.all(promiseResults).then(function(dataArr) {\r\n                    console.log(dataArr);\r\n                    tempSrc.data = dataArr;\r\n                    renderCol3d(tempSrc);\r\n                  })\r\n            }\r\n        })*/\n    });\n});","require([\r\n    \"esri/Map\",\r\n    \"esri/views/MapView\",\r\n    \"esri/layers/MapImageLayer\",\r\n    \"esri/layers/FeatureLayer\",\r\n    \"esri/PopupTemplate\",\r\n    \"esri/widgets/Legend\",\r\n    \"esri/widgets/Compass\",\r\n    \"esri/widgets/Compass/CompassViewModel\",\r\n    \"esri/widgets/Home\",\r\n    \"esri/widgets/Home/HomeViewModel\",\r\n    \"esri/widgets/BasemapToggle\",\r\n    \"esri/widgets/Popup\",\r\n    \"esri/tasks/QueryTask\",\r\n    \"esri/tasks/support/Query\",\r\n    \"dojo/domReady!\"\r\n], function(Map, MapView, MapImageLayer, FeatureLayer, PopupTemplate, Legend, Compass, CompassVM, Home, HomeVM, BasemapToggle, Popup, QueryTask, Query) {\r\n\r\n    var map = new Map({\r\n        basemap: \"oceans\"\r\n    });\r\n\r\n    var view = new MapView({\r\n        container: \"map-container\",\r\n        map: map,\r\n        zoom: 9,\r\n        center: [121, 33]\r\n    });\r\n    var services = ['zoning', 'authorized', 'authorized_source', 'authorized_cata1', 'authorized_cata2', 'authorized_method'];\r\n    view.then(function() {\r\n\r\n        var content = \"<b>{FID}</b> {OBJECTID}<br>\" +\r\n            \"功能区类型:{功能区类型}<br>\" + \"{SHAPE_LEN}\" + \"<img src='https://www.google.com/logos/doodles/2016/mohammed-ghani-hikmats-87th-birthday-5708620060688384-hp2x.jpg' />\";\r\n        var tableContent = '<table class=\"ui celled table\"><tbody><tr><td>' + 'FID' + '</td><td>' + '{FID}' + '</td></tr><tr><td>' + '配号来源' + '</td><td>' + '{配号来源}' + '</td></tr><tr><td>' + '用海一级类' + '</td><td>' + '{用海一级类}' + '</td></tr><tr><td>' + '用海二级类' + '</td><td>' + '{用海二级类}' + '</td></tr><tr><td>' + '用海方式' + '</td><td>' + '{用海方式}' + '</td></tr></tbody></table>'\r\n\r\n        //==widgets======================//\r\n        var compass = new Compass({\r\n            viewModel: new CompassVM({\r\n                view: view\r\n            })\r\n        }, \"compass\");\r\n        compass.startup();\r\n\r\n        var homeBtn = new Home({\r\n            viewModel: new HomeVM({\r\n                view: view\r\n            })\r\n        }, \"home\");\r\n        homeBtn.startup();\r\n\r\n        var basemapToggle = new BasemapToggle({\r\n            view: view,\r\n            nextBasemap: \"dark-gray\"\r\n        }, 'basemap');\r\n        basemapToggle.startup();\r\n\r\n        //var legend = new Legend({ view: view }, 'legend');\r\n\r\n        var legend = new Legend({\r\n            view: view\r\n        });\r\n        legend.startup();\r\n\r\n        view.ui.add(legend, \"bottom-right\");\r\n        //==widgets======================//\r\n\r\n\r\n        var authLyrCtrl = function() {\r\n\r\n            var lyrIds = ['功能区划', '确权数据', '确权数据--配号来源', '确权数据--用海一级类', '确权数据--用海二级类', '确权数据--用海方式'];\r\n            var authLyrs = [];\r\n            authLyrs[1] = new FeatureLayer({\r\n                id: lyrIds[1],\r\n                url: \"http://localhost:6080/arcgis/rest/services/allofit/MapServer/1\",\r\n                popupTemplate: new PopupTemplate({\r\n                    title: 'title',\r\n                    content: tableContent\r\n                })\r\n            });\r\n            map.add(authLyrs[1]);\r\n            var inviewIndex = 1;\r\n            for (var i = 2; i < 6; i++) {\r\n                var tempLyr = new FeatureLayer({\r\n                    id: lyrIds[i],\r\n                    url: \"http://localhost:6080/arcgis/rest/services/allofit/MapServer/\" + i,\r\n                    popupTemplate: new PopupTemplate({\r\n                        title: 'title',\r\n                        content: tableContent\r\n                    })\r\n                });\r\n                authLyrs.push(tempLyr);\r\n            }\r\n\r\n            view.whenLayerView(authLyrs[1]).then(function(lyrView) {\r\n                lyrView.watch(\"updating\", function(val) {\r\n                    if (!val) { // wait for the layer view to finish updating\r\n\r\n                        // query all the features available for drawing.\r\n                        lyrView.queryFeatures().then(function(results) {\r\n                            console.log(results[0]);\r\n\r\n                            /*graphics = results;\r\n                        var fragment = document.createDocumentFragment();\r\n\r\n                        results.forEach(function(result, index) {\r\n                          var attributes = result.attributes;\r\n                          var name = attributes.ZIP + \" (\" +\r\n                            attributes.PO_NAME + \")\"\r\n\r\n                          // Create a list zip codes in NY\r\n                          domConstruct.create(\"li\", {\r\n                            className: \"panel-result\",\r\n                            tabIndex: 0,\r\n                            \"data-result-id\": index,\r\n                            textContent: name\r\n                          }, fragment);\r\n                        });\r\n                        domConstruct.place(fragment, listNode, \"only\");*/\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n            /*on(listNode, on.selector(\"li\", a11yclick), function(evt) {\r\n                var target = evt.target;\r\n                var resultId = domAttr.get(target, \"data-result-id\");\r\n\r\n                // get the graphic corresponding to the clicked zip code\r\n                var result = resultId && graphics && graphics[parseInt(resultId,\r\n                    10)];\r\n\r\n                if (result) {\r\n                    // open the popup at the centroid of zip code polygon\r\n                    // and set the popup's features which will populate popup content and title.\r\n                    view.popup.open({\r\n                        features: [result],\r\n                        location: result.geometry.centroid\r\n                    });\r\n                }\r\n            });*/\r\n\r\n            return {\r\n                on: true,\r\n                switchTo: function to(val) {\r\n                    if (val !== inviewIndex) {\r\n                        map.remove(authLyrs[inviewIndex]);\r\n                        map.add(authLyrs[val]);\r\n                    }\r\n                },\r\n                show: function() {\r\n                    map.add(authLyrs[inviewIndex]);\r\n                    this.on = true;\r\n                },\r\n                hide: function() {\r\n                    map.remove(authLyrs[inviewIndex]);\r\n                    this.on = false;\r\n                }\r\n            }\r\n        }();\r\n\r\n\r\n        var zoningLyrCtrl = function() {\r\n\r\n            var zoningLyr = new FeatureLayer({\r\n                id: '功能区划',\r\n                url: \"http://localhost:6080/arcgis/rest/services/zoning/MapServer/0\",\r\n            });\r\n\r\n            return {\r\n                on: false,\r\n                toggle: function() {\r\n                    if (this.on) {\r\n                        map.remove(zoningLyr);\r\n                    } else {\r\n\r\n                        map.add(zoningLyr);\r\n                        if (authLyrCtrl.on) {\r\n                            authLyrCtrl.hide;\r\n                            authLyrCtrl.show;\r\n\r\n                        }\r\n                    };\r\n                    this.on = !this.on;\r\n                }\r\n            }\r\n        }();\r\n\r\n        $('input.toggle.toggle-zoning').change(function() {\r\n            zoningLyrCtrl.toggle();\r\n            console.log(zoningLyrCtrl.on)\r\n        })\r\n\r\n        $('input.toggle.toggle-zoning').change(function() {\r\n            if ($(this).val() == 'on') {\r\n                authLyrCtrl.show;\r\n            } else {\r\n                authLyrCtrl.hide;\r\n\r\n            }\r\n        })\r\n        $('select[name=authLyr]').change(function() {\r\n            authLyrCtrl.switchTo($(this).val());\r\n        });\r\n\r\n        function dataSrc() {\r\n            this.chart = {\r\n                \"caption\": \"确权数据分类\",\r\n                \"subCaption\": \"用海一级类\",\r\n                \"xAxisName\": \"用海一级类\",\r\n                \"yAxisName\": \"数量\",\r\n                \"theme\": \"fint\"\r\n            };\r\n            this.data = [];\r\n        }\r\n        var col3dShow = [];\r\n\r\n        /*$.get('http://localhost:6080/arcgis/rest/services/allofit/MapServer/legend?f=pjson', function(res) {\r\n            legendJson = JSON.parse(res);\r\n            for (var i = 1; i < 6; i++) {\r\n                var layerTemp = legendJson.layers[i];\r\n                var layerLegend = layerTemp.legend;\r\n                var tempSrc = new dataSrc();\r\n                tempSrc.chart.subCaption = layerTemp.layerName;\r\n                tempSrc.chart.xAxisName = layerTemp.layerName;\r\n                var queryStatesTask = new QueryTask({\r\n                    url: \"http://localhost:6080/arcgis/rest/services/allofit/MapServer/\" + i\r\n                });\r\n                var promiseResults = [];\r\n                for (var j = layerLegend.length - 1; i >= 0; i--) {\r\n                    var legd = layerLegend[i];\r\n                    promiseResults.push(new Promise((resolve, reject) => {\r\n                        var query = new Query();\r\n                        query.where = layerTemp.layerName + \" = \" + \"'\" + legd.label + \"'\";\r\n                        queryStatesTask.execute(query).then(function(result) {\r\n                            console.log(result.features.length);\r\n                            var tempData = {\r\n                                \"label\": legd.label,\r\n                                \"value\": result.features.length\r\n                            };\r\n                            resolve(tempData);\r\n                        });\r\n                    }))\r\n                }\r\n                Promise.all(promiseResults).then(function(dataArr) {\r\n                    console.log(dataArr);\r\n                    tempSrc.data = dataArr;\r\n                    renderCol3d(tempSrc);\r\n\r\n                })\r\n            }\r\n        })*/\r\n    });\r\n\r\n});\r\n"],"sourceRoot":"/source/"}